// JavaScript Document
function customClearance(request, response) {
    if (request.getMethod() == 'GET') {
        var recId = request.getParameter('recName');
        //var css = GenerateCSSForReport();
        //get shipment information for template - ajr
        var record = nlapiLoadRecord('customrecord_pss_shipment', recId, null, null);
        var recNum = record.getFieldValue('name');
        var shipName = record.getFieldText('custrecord_pss_shipper');
        var ShipperEnt = record.getFieldValue('custrecord_pss_shipper');
        var ShipperEntType = nlapiLookupField('entity', ShipperEnt, 'type');
        if (ShipperEntType === 'CustJob') {
            ShipperEntType = 'customer';
        }
        var ConsEnt = record.getFieldValue('custrecord_pss_consignee');
        var consigneeName = record.getFieldText('custrecord_pss_consignee');
        var ConsType = nlapiLookupField('entity', ConsEnt, 'type');
        if (ConsType === 'CustJob') {
            ConsType = 'customer';
        }
        var BillToEnt = record.getFieldValue('custrecord_pss_freight_bill_to');
        var BillToName = record.getFieldText('custrecord_pss_freight_bill_to');
        var BillToType = nlapiLookupField('entity', BillToEnt, 'type');
        if (BillToType === 'CustJob') {
            BillToType = 'customer';
        }
        nlapiLogExecution('DEBUG', 'Shipper Entity Type', 'Entity Type is ' + ShipperEntType);
        nlapiLogExecution('DEBUG', 'Consignee Entity Type', 'Entity Type is ' + ConsType);
        nlapiLogExecution('DEBUG', 'Bill To Entity Type', 'Entity Type is ' + BillToType);
        var carrierText = record.getFieldText('custrecord_pss_carrier');
        var shipDate = record.getFieldValue('custrecord_pss_ship_date');
        var refatpickup = record.getFieldValue('custrecord_pss_reference_pickup');
        var customsBroker = record.getFieldValue('custrecord_pss_customsbroker');
        var portOfEntry = record.getFieldValue('custrecord_pss_portofentry');
        var refatdelivery = record.getFieldValue('custrecord_pss_reference_delivery');
        var shipper = nlapiLoadRecord(ShipperEntType, ShipperEnt);
        var shipperAddr1 = shipper.getFieldValue('shipaddr1');
        var shipperAddr2 = shipper.getFieldValue('shipaddr2');
        var shipperCity = shipper.getFieldValue('shipcity');
        var shipperState = shipper.getFieldValue('shipstate');
        var shipperZip = shipper.getFieldValue('shipzip');
        var shipperCountry = shipper.getFieldValue('shipcountry');
        var consignee = nlapiLoadRecord(ConsType, ConsEnt);
        var consigneeAddr1 = consignee.getFieldValue('shipaddr1');
        var consigneeAddr2 = consignee.getFieldValue('shipaddr2');
        if (consigneeAddr2 === null) {
            consigneeAddr2 = '';
        }
        var consigneeCity = consignee.getFieldValue('shipcity');
        var consigneeState = consignee.getFieldValue('shipstate');
        var consigneeZip = consignee.getFieldValue('shipzip');
        var consigneeCountry = consignee.getFieldValue('shipcountry');
        var billToRec = nlapiLoadRecord(BillToType, BillToEnt);
        var billToAddr1 = billToRec.getFieldValue('shipaddr1');
        var billToAddr2 = billToRec.getFieldValue('shipaddr2');
        if (billToAddr2 === null) {
            billToAddr2 = '';
        }
        var billToCity = billToRec.getFieldValue('shipcity');
        var billToState = billToRec.getFieldValue('shipstate');
        var billToZip = billToRec.getFieldValue('shipzip');
        nlapiLogExecution('DEBUG', 'Addresing Complete', 'Bill To Zip is ' + billToZip);
        //get shipment lines information for template - ajr
        var linHazmat = new Array();
        var linPicCount = new Array();
        var linType = new Array();
        var linNum = new Array();
        var linDesc = new Array();
        var linHTS = new Array();
        var linWeight = new Array();
        var linUnitPrice = new Array();
        var linExtendedTotal = new Array();
        var items = new Array();
        var totLPC = 0;
        var totLPic = 0;
        var totWeight = 0;
        var totAmount = 0;
        var pkgcount = new Array();
        var fil = new Array();
        fil[0] = new nlobjSearchFilter('custrecord_pss_shipment_parent', null, 'is', 123457048);
        var col = new Array();
        col[0] = new nlobjSearchColumn('custrecord_pss_pkgnumber');
        col[1] = new nlobjSearchColumn('custrecord_pss_htsnumber');
        col[2] = new nlobjSearchColumn('custrecord_pss_ship_line_item_desc');
        col[3] = new nlobjSearchColumn('custrecord_pss_packagetype');
        col[4] = new nlobjSearchColumn('custrecord_pss_weight');
        col[5] = new nlobjSearchColumn('custrecord_pss_unitprice');
        col[6] = new nlobjSearchColumn('custrecord_pss_extendedtotal');
        var packages = nlapiSearchRecord('customrecord_pss_shipment_line', null, fil, col);
        for (var x = 0; x < packages.length; x++) {
            pkgcount.push(packages[x].getValue('custrecord_pss_pkgnumber'));
            var linPicCount = packages[x].getValue('custrecord_pss_pkgnumber');
            var linHTS = packages[x].getValue('custrecord_pss_htsnumber');
            var linDesc = packages[x].getValue('custrecord_pss_ship_line_item_desc');
            var linType = packages[x].getText('custrecord_pss_packagetype');
            var linWeight = packages[x].getValue('custrecord_pss_weight');
            var linNum = packages[x].getValue('custrecord_pss_pkgnumber');
            var linUnitPrice = packages[x].getValue('custrecord_pss_unitprice');
            var linExtendedTotal = packages[x].getValue('custrecord_pss_extendedtotal');
            //totLPic += Number(linNum);
            totWeight += Number(linWeight);
            totAmount += Number(linExtendedTotal);
            var totAmountDisplay = nlapiFormatCurrency(totAmount);
          
            items += '<tr style="height:15pt"><td style="border-top-style:solid;border-top-width:.5pt;border-left-style:solid;border-left-width:.5pt;border-bottom-style:solid;border-bottom-width:.5pt;border-right-style:solid;border-right-width:.5pt" rowspan="1"><p class="s2" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">' + shipperCountry +'</p></td>';
            items += '<td style="border-top-style:solid;border-top-width:.5pt;border-left-style:solid;border-left-width:.5pt" colspan="3"><p class="s2" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">' + linDesc +'</p></td>';
            items += '<td style="border-top-style:solid;border-top-width:.5pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td>';
            items += '<td style="border-top-style:solid;border-top-width:.5pt;border-right-style:solid;border-right-width:.5pt" colspan="2"><p class="s2" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">' + linHTS +'</p></td>';
            items += '<td style="border-top-style:solid;border-top-width:.5pt;border-left-style:solid;border-left-width:.5pt;border-bottom-style:solid;border-bottom-width:.5pt;border-right-style:solid;border-right-width:.5pt" rowspan="1"><p class="s2" style="padding-top: 2pt;padding-left: 17pt;text-indent: 0pt;text-align: right;">' + linPicCount +'</p></td>';
            items += '<td style="border-top-style:solid;border-top-width:.5pt;border-left-style:solid;border-left-width:.5pt;border-bottom-style:solid;border-bottom-width:.5pt;border-right-style:solid;border-right-width:.5pt" colspan="3" rowspan="1"><p class="s2" style="padding-top: 2pt;padding-left: 18pt;text-indent: 0pt;text-align: right;">' + linUnitPrice +'</p></td>';
            items += '<td style="border-top-style:solid;border-top-width:.5pt;border-left-style:solid;border-left-width:.5pt;border-bottom-style:solid;border-bottom-width:.5pt;border-right-style:solid;border-right-width:.5pt" rowspan="1"><p class="s2" style="padding-top: 2pt;padding-left: 20pt;text-indent: 0pt;text-align: right;">' + linExtendedTotal +'</p></td></tr>';
          }

        var pkgcnt = Math.max.apply(null, pkgcount);
        var hotTots = '<tr><td>Total Package Count:' + '</td><td>' + pkgcnt + '</td><td>' + '' + '</td><td>' + '' + '</td><td>' + '' + '</td><td>' + 'Total Weight:' + '</td><td>' + totWeight + 'lbs' + '</td></tr>';
        nlapiLogExecution('DEBUG', 'Line Item Count', 'lines array: ' + items + '');
        //begin template well formed XML - ajr
        try {
          var xml = '<?xml version=\"1.0\"?>\n<!DOCTYPE pdf PUBLIC \"-//big.faceless.org//report\" \"report-1.1.dtd\">\n';
          xml += '<pdf>';
          xml += '<link name="verdana" type="font" subtype="opentype" src="${nsfont.verdana}" src-bold="${nsfont.verdana_bold}" bytes="2" />';
          xml += '<head>';
          xml += '<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>';
          xml += '<meta name="title" value="Customs Declaration"/>';
          xml += '<meta name="layout" value="single-page"/>';
          xml += '<style type="text/css"> * {margin:0; padding:0; text-indent:0; }';
          xml += 'h2 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }';
          xml += 'p { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; margin:0pt; }';
          xml += 'h1 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }';
          xml += 'a { color: #00F; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 7pt; }';
          xml += '.s1 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }';
          xml += '.s2 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }';
          xml += '.s3 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }';
          xml += '.s4 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }';
          xml += '.s5 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }';
          xml += '.s6 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; vertical-align: -2pt; }';
          xml += '.s7 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }';
          xml += '.s8 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }';
          xml += '.s9 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }';
          xml += '.s10 { color: black; font-family:Wingdings; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }';
          xml += '.s12 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8pt; }';
          xml += '.s13 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }';
          xml += '.s14 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }';
          xml += '.s16 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }';
          xml += '.s17 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }';
          xml += '</style>';
          xml += '</head>';
          xml += '<body size="letter" margin="0.1in">';
          xml += '<h1 style="padding-top: 0pt;padding-left: 70pt;text-indent: 0pt;text-align: center;">COMBINATION: INVOICE - DECLARATION BY FOREIGN SHIPPER</h1>';
          xml += '<table style="border-collapse:collapse;margin-left:6.03pt" cellspacing="0">';
          xml += '<tr style="height:14pt">';
          xml += '<td>';
          xml += '<p class="s1" style="padding-top: 5pt;padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">For Customs Clearance By</p>';
          xml += '<p class="s2" style="padding-top: 5pt;padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">' + customsBroker + '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-width:0pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '<p class="s5" style="padding-left: 100pt;text-indent: 0pt;text-align: center;">INVOICE</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="width=100%;height:17pt">';
          xml += '<td style="border-top-style:solid;border-top-width:2pt;border-left-style:solid;border-left-width:2pt;border-bottom-style:solid;border-bottom-width:2pt" colspan="2">';
          xml += '<p class="s2" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">SHIPMENT REFERENCE: Pliteq</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:2pt;border-left-style:solid;border-left-width:2pt;border-bottom-style:solid;border-bottom-width:2pt;border-right-style:solid;border-right-width:2pt" colspan="2">';
          xml += '<p class="s2" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">SHIPMENT CONTROL #:' + recNum +'</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '</table>';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '<table style="border-collapse:collapse;margin-left:6.02pt" cellspacing="0">';
          xml += '<tr style="height:72pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="6">';
          xml += '<p class="s1" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">EXPORTER, SELLER</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">' + shipName + '</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">' + shipperAddr1 + '</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">' + shipperAddr2 + '</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">' + shipperCity + ', ' + shipperState + ' ' + shipperZip + '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="6">';
          xml += '<p class="s1" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">PRODUCER OF GOODS (IF DIFFERENT THAN EXPORTER)</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:40pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt" colspan="2">';
          xml += '<p class="s1" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">SHIPPED TO, CONSIGNEE</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">' + consigneeName + '</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">' + consigneeAddr1 + '</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">' + consigneeAddr2 + '</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">' + consigneeCity + ', ' + consigneeState + ' ' + consigneeZip + '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-right-style:solid;border-right-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BUYER (IF DIFFERENT THAN CONSIGNEE)</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-right-style:solid;border-right-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:37pt">';
          xml += '<td style="border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '<p class="s1" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">IRS NUMBER:</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '<p class="s1" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">IRS NUMBER:</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:23pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">PARTIES TO THIS TRANSACTION ARE</p>';
          xml += '<p class="s2" style="padding-left: 7pt;padding-right: 25pt;text-indent: 0pt;line-height: 108%;text-align: left;">  [       ]       Related           [x]       Not        Related </p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">COUNTRY OF FINAL DEST. (IF OTHER THAN U.S.A.)</p>';
          xml += '<p class="s2" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">' + shipperCountry + '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">INVOICE DATE</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 0pt;text-indent: 0pt;text-align: left;">' + shipDate + '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">DATE OF SALE</p>';
          xml += '<p class="s2" style="padding-top: 0pt;padding-left: 0pt;text-indent: 0pt;text-align: left;">' + shipDate + '</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:25pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="6" rowspan="3">';
          xml += '<p class="s2" style="padding-left: 7pt;padding-right: 25pt;text-indent: 0pt;line-height: 108%;text-align: left;">US Duty &amp; Brokerage Chgs for: [x] Shipper [ ] Consignee [ ] Other F.O.B.:       [      ]       Plant       [x]      Destination       [      ]      Other </p>';
          xml += '<p class="s2" style="padding-left: 7pt;padding-right: 25pt;text-indent: 0pt;line-height: 108%;text-align: left;">Duty &amp; Brokerage Fees Included: [x] Yes [ ] No</p>';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '<p class="s6" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 250%;text-align: left;"><span>05</span><span class="s7">  </span>EXPORTER <span>06</span><span class="s8">  </span>SHIP TO, CONSIGNEE <span>07</span><span class="s8">  </span>OTHER (specify) LIVINGSTON ACCOUNT NUMBER:</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s6" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">DISCOUNTS</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">PORT OF ENTRY:</p>';
          xml += '<p class="s2" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">' + portOfEntry + '</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:26pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="6">';
          xml += '<p class="s6" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">TERMS OF SALE</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:16pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="6">';
          xml += '<p class="s6" style="padding-left: 2pt;text-indent: 0pt;line-height: 5pt;text-align: left;">CURRENCY OF SALE</p>';
          xml += '<p class="s6" style="padding-left: 68pt;text-indent: 0pt;line-height: 8pt;text-align: left;"><span>08</span><span class="s7">  </span>U.S. <span>09</span><span class="s8">  </span>CANADIAN <span>10</span><span class="s8">  </span>OTHER (specify) <u>         </u>';
          xml += '</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:20pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="1">';
          xml += '<p class="s1" style="padding-left: 3pt;text-indent: 0pt;line-height: 6pt;text-align: left;">MARKS AND NUMBERS</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">NUMBERS AND KIND OF PACKAGES</p>';
          xml += '<p class="s2" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;vertical-align: text-bottom;">' + pkgcnt + '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">SHIPPING WEIGHT</p>';
          xml += '<br/>';
          xml += '<p class="s2" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;vertical-align: text-bottom;">' + totWeight + ' LBS</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s1" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">FREIGHT AMOUNT INCLUDED</p>';
          xml += '<p class="s2" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: right;vertical-align: text-bottom;">' + pkgcnt + '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="2">';
          xml += '<p class="s1" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: right;">FREIGHT AMOUNT TO BORDER</p>';
          xml += '<p class="s2" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: right;vertical-align: text-bottom;">' + pkgcnt + '</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:20pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" rowspan="1">';
          xml += '<p class="s6" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">COUNTRY OF ORIGIN</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt" colspan="3">';
          xml += '<p class="s6" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">DESCRIPTION OF GOODS</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="2">';
          xml += '<p class="s6" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">TEN DIGIT H.T.S. NUMBER</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" rowspan="1">';
          xml += '<p class="s6" style="padding-top: 2pt;padding-left: 17pt;text-indent: 0pt;text-align: right;">UNIT QTY.</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3" rowspan="1">';
          xml += '<p class="s6" style="padding-top: 2pt;padding-left: 18pt;text-indent: 0pt;text-align: right;">UNIT PRICE</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" rowspan="1">';
          xml += '<p class="s1" style="padding-top: 2pt;padding-left: 20pt;text-indent: 0pt;text-align: right;">INVOICE TOTAL</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += items;
          xml += '<tr style="height:19pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="10">';
          xml += '<p class="s12" style="padding-top: 6pt;padding-left: 140pt;text-indent: 0pt;text-align: right;">INVOICE TOTAL</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"  colspan="2">';
          xml += '<p class="s12" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: right;">USD $' + totAmountDisplay + '</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:31pt">';
          xml += '<td style="border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="8">';
          xml += '<p class="s6" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">COMMENTS</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="4">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '<p class="s1" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ABOVE PRICES INCLUDE</p>';
          xml += '<p class="s2" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: right;">[ ] Duty [ ] Brokerage [ ] Freight</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:51pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="12">';
          xml += '<p class="s14" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;"><a name="bookmark4">DECLARATION BY FOREIGN SHIPPER (To be completed only when the goods described above are of U.S. origin and their value exceeds $500.00)</a>';
          xml += '</p>';
          xml += '<p class="s1" style="padding-top: 3pt;padding-left: 2pt;padding-right: 14pt;text-indent: 0pt;text-align: left;">I<u>                                                          </u> _ declare that the articles herein specified are to the best of my knowledge and belief, the growth, produce or manufacture of the United States: That they were exported from the United States from the port of<u>                                                    </u> on or about   <u>                                                   </u> _ that they are returned without having been advanced in value or improved in condition by any process of manufacture or other means. Any shipment that contains U.S. goods returned valued over $2,500 should have a manufacturerâ€™s affidavit attached to this invoice.</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:12pt">';
          xml += '<td style="border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p class="s1" style="padding-top: 4pt;padding-left: 3pt;text-indent: 0pt;line-height: 6pt;text-align: left;">SHIPPER</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p class="s1" style="padding-top: 4pt;padding-left: 3pt;text-indent: 0pt;line-height: 6pt;text-align: left;">SIGNATURE</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p class="s1" style="padding-top: 4pt;padding-left: 3pt;text-indent: 0pt;line-height: 6pt;text-align: left;">DATE SIGNED</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '<td style="border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt">';
          xml += '<p style="text-indent: 0pt;text-align: left;">';
          xml += '<br/>';
          xml += '</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '<tr style="height:26pt">';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="4">';
          xml += '<p class="s16" style="padding-top: 1pt;padding-left: 5pt;padding-right: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">To the best of the knowledge and belief of the preparer this invoice is true and complete and discloses the true prices, values, quantities, rebates, drawbacks, fees, commissions, royalties and any goods or services provided to the seller either free orat a reduced cost.</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3">';
          xml += '<p class="s16" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">PREPARER (IF OTHER THAN EXPORTER)</p>';
          xml += '</td>';
          xml += '<td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="5">';
          xml += '<p class="s16" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">NAME OF RESPONSIBLE EMPLOYEE OF EXPORTER</p>';
          xml += '</td>';
          xml += '</tr>';
          xml += '</table>';
          xml += '</body>';
          xml += '</pdf>';

          //end of ttemplate begining of render
            var file = nlapiXMLToPDF(xml);
            var contents = file.getValue();
            var renderer = nlapiCreateTemplateRenderer(contents);
            renderer.setTemplate(contents);
            var renderPDF = renderer.renderToString();
            response.setContentType('PDF', recNum + '.pdf', 'inline');
            response.write(renderPDF);
            nlapiLogExecution('DEBUG', 'PDF Rendered', 'Custom Clearance was rendered!');
        } catch (err) {
            nlapiLogExecution('DEBUG', 'Error Caught', 'Error is ' + err);
        }
    } // JavaScript source code
} // JavaScript source code
